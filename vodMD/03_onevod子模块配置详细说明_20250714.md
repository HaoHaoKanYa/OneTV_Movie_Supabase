# onevodå­æ¨¡å—é…ç½®è¯¦ç»†è¯´æ˜Ž

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-07-14  
**ç›®æ ‡**: è¯¦ç»†è¯´æ˜Žonevodæ¨¡å—ä¸­æ¯ä¸ªå­æ¨¡å—çš„é…ç½®æ–¹æ³•

## ðŸ“‹ å­æ¨¡å—æ¦‚è§ˆ

### æ ¸å¿ƒå­æ¨¡å—åˆ—è¡¨
```
onevod/
â”œâ”€â”€ catvod/          # çˆ¬è™«æ ¸å¿ƒå¼•æ“Ž (å¿…éœ€) âœ…
â”œâ”€â”€ quickjs/         # JavaScriptå¼•æ“Ž (å¿…éœ€) âœ…
â”œâ”€â”€ chaquo/          # Pythonå¼•æ“Ž (å¿…éœ€) âœ…
â”œâ”€â”€ hook/            # Hookæœºåˆ¶ (å¿…éœ€) âœ…
â”œâ”€â”€ forcetech/       # è§£æžå™¨æ¨¡å— (å¿…éœ€) âœ…
â”œâ”€â”€ jianpian/        # è§£æžå™¨æ¨¡å— (å¿…éœ€) âœ…
â”œâ”€â”€ thunder/         # è¿…é›·è§£æžå™¨ (å¿…éœ€) âœ…
â””â”€â”€ tvbus/           # ç›´æ’­è§£æžå™¨ (å¿…éœ€) âœ…
```

**é‡è¦è¯´æ˜Ž**: æ‰€æœ‰æ¨¡å—éƒ½æ˜¯å¿…éœ€çš„ï¼Œç¡®ä¿FongMi_TVåŠŸèƒ½100%å®Œæ•´ä¿ç•™

## ðŸ”§ å­æ¨¡å—é…ç½®è¯¦è§£

### 1. catvodæ¨¡å— (æ ¸å¿ƒçˆ¬è™«å¼•æ“Ž)

#### ç›®å½•ç»“æž„
```
onevod/catvod/
â”œâ”€â”€ src/main/java/com/github/catvod/
â”‚   â”œâ”€â”€ crawler/     # çˆ¬è™«æŽ¥å£å’Œå®žçŽ°
â”‚   â”œâ”€â”€ net/         # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ utils/       # å·¥å…·ç±»
â”‚   â””â”€â”€ bean/        # æ•°æ®æ¨¡åž‹
â”œâ”€â”€ libs/            # ç¬¬ä¸‰æ–¹JARåŒ…
â””â”€â”€ build.gradle.kts # æž„å»ºé…ç½®
```

#### build.gradle.ktsé…ç½®
```kotlin
plugins {
    id("com.onetv.library")
}

android {
    namespace = "com.github.catvod.crawler"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    
    buildFeatures {
        buildConfig = true
    }
}

dependencies {
    api(fileTree(mapOf("dir" to "libs", "include" to listOf("*.jar"))))
    
    // æ ¸å¿ƒä¾èµ–
    api("androidx.annotation:annotation:1.6.0")
    api("androidx.preference:preference:1.2.1")
    api("com.google.code.gson:gson:2.11.0")
    api("com.squareup.okhttp3:okhttp:5.0.0-alpha.14")
    api("com.squareup.okhttp3:okhttp-dnsoverhttps:5.0.0-alpha.14")
    api("com.squareup.okhttp3:logging-interceptor:5.0.0-alpha.14")
    api("com.googlecode.juniversalchardet:juniversalchardet:1.0.3")
    api("com.orhanobut:logger:2.2.0")
    
    // Cronetæ”¯æŒ
    api("com.google.net.cronet:cronet-okhttp:0.1.0")
    api("org.chromium.net:cronet-embedded:76.3809.111")
    
    // Guavaå·¥å…·åº“
    api("com.google.guava:guava:33.3.1-onetv") {
        exclude(group = "com.google.code.findbugs", module = "jsr305")
        exclude(group = "org.checkerframework", module = "checker-compat-qual")
        exclude(group = "org.checkerframework", module = "checker-qual")
        exclude(group = "com.google.errorprone", module = "error_prone_annotations")
        exclude(group = "com.google.j2objc", module = "j2objc-annotations")
        exclude(group = "org.codehaus.mojo", module = "animal-sniffer-annotations")
    }
}
```

### 2. quickjsæ¨¡å— (JavaScriptå¼•æ“Ž)

#### ç›®å½•ç»“æž„
```
onevod/quickjs/
â”œâ”€â”€ src/main/
â”‚   â”œâ”€â”€ java/com/script/
â”‚   â””â”€â”€ jniLibs/         # åŽŸç”Ÿåº“æ–‡ä»¶
â”‚       â”œâ”€â”€ arm64-v8a/
â”‚       â””â”€â”€ armeabi-v7a/
â””â”€â”€ build.gradle.kts
```

#### build.gradle.ktsé…ç½®
```kotlin
plugins {
    id("com.onetv.library")
}

android {
    namespace = "com.script"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    
    buildFeatures {
        buildConfig = true
    }
    
    packagingOptions {
        jniLibs {
            useLegacyPackaging = true
        }
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
}
```

### 3. chaquoæ¨¡å— (Pythonå¼•æ“Ž)

#### ç›®å½•ç»“æž„
```
onevod/chaquo/
â”œâ”€â”€ src/main/
â”‚   â”œâ”€â”€ java/com/chaquo/
â”‚   â””â”€â”€ python/          # Pythonè„šæœ¬æ–‡ä»¶
â””â”€â”€ build.gradle.kts
```

#### build.gradle.ktsé…ç½®
```kotlin
plugins {
    id("com.onetv.library")
    id("com.chaquo.python")
}

android {
    namespace = "com.chaquo.python"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
        
        ndk {
            abiFilters += listOf("arm64-v8a", "armeabi-v7a")
        }
        
        python {
            buildPython("3.8")
            pip {
                install("requests")
                install("beautifulsoup4")
                install("lxml")
                install("cryptography")
                install("pycryptodome")
            }
        }
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
}
```

### 4. hookæ¨¡å— (Hookæœºåˆ¶)

#### build.gradle.ktsé…ç½®
```kotlin
plugins {
    id("com.onetv.library")
}

android {
    namespace = "com.github.tvbox.osc.hook"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
    api(project(":onevod:catvod"))
}
```

### 5. è§£æžå™¨æ¨¡å— (forcetech, jianpian, thunder, tvbus)

#### é€šç”¨build.gradle.ktsæ¨¡æ¿
```kotlin
plugins {
    id("com.onetv.library")
}

android {
    namespace = "com.forcetech.onetv" // æ ¹æ®æ¨¡å—è°ƒæ•´
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
    api(project(":onevod:catvod"))
    
    // æ ¹æ®æ¨¡å—éœ€è¦æ·»åŠ ç‰¹å®šä¾èµ–
    implementation("com.squareup.okhttp3:okhttp:5.0.0-alpha.14")
    implementation("com.google.code.gson:gson:2.11.0")
}
```

## ðŸ“ é…ç½®æ–‡ä»¶åˆ›å»ºè„šæœ¬

### PowerShellè„šæœ¬ (create_submodule_configs.ps1)
```powershell
# åˆ›å»ºæ‰€æœ‰å­æ¨¡å—çš„build.gradle.ktsæ–‡ä»¶

$modules = @{
    "catvod" = "com.github.catvod.crawler"
    "quickjs" = "com.script"
    "chaquo" = "com.chaquo.python"
    "hook" = "com.github.tvbox.osc.hook"
    "forcetech" = "com.forcetech.android"
    "jianpian" = "com.jianpian.android"
    "thunder" = "com.thunder.android"
    "tvbus" = "com.tvbus.android"
}

foreach ($module in $modules.Keys) {
    $namespace = $modules[$module]
    $buildFile = "onevod\$module\build.gradle.kts"
    
    if (Test-Path "onevod\$module") {
        $content = @"
plugins {
    id("com.android.library")
}

android {
    namespace = "$namespace"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    
    buildFeatures {
        buildConfig = true
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
    
    // æ ¹æ®æ¨¡å—éœ€è¦æ·»åŠ ä¾èµ–
    if ("$module" -ne "quickjs") {
        api(project(":onevod:catvod"))
    }
    
    implementation("com.squareup.okhttp3:okhttp:5.0.0-alpha.14")
    implementation("com.google.code.gson:gson:2.11.0")
}
"@
        
        Set-Content -Path $buildFile -Value $content -Encoding UTF8
        Write-Host "å·²åˆ›å»º: $buildFile" -ForegroundColor Green
    }
}
```

### Bashè„šæœ¬ (create_submodule_configs.sh)
```bash
#!/bin/bash

# åˆ›å»ºæ‰€æœ‰å­æ¨¡å—çš„build.gradle.ktsæ–‡ä»¶

declare -A modules=(
    ["catvod"]="com.github.catvod.crawler"
    ["quickjs"]="com.script"
    ["chaquo"]="com.chaquo.python"
    ["hook"]="com.github.tvbox.osc.hook"
    ["forcetech"]="com.forcetech.android"
    ["jianpian"]="com.jianpian.android"
    ["thunder"]="com.thunder.android"
    ["tvbus"]="com.tvbus.android"
)

for module in "${!modules[@]}"; do
    namespace=${modules[$module]}
    build_file="onevod/$module/build.gradle.kts"
    
    if [ -d "onevod/$module" ]; then
        cat > "$build_file" << EOF
plugins {
    id("com.android.library")
}

android {
    namespace = "$namespace"
    compileSdk = 35
    
    defaultConfig {
        minSdk = 21
        targetSdk = 28
        consumerProguardFiles("consumer-rules.pro")
    }
    
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    
    buildFeatures {
        buildConfig = true
    }
}

dependencies {
    api("androidx.annotation:annotation:1.6.0")
    
    if [ "$module" != "quickjs" ]; then
        api(project(":onevod:catvod"))
    fi
    
    implementation("com.squareup.okhttp3:okhttp:5.0.0-alpha.14")
    implementation("com.google.code.gson:gson:2.11.0")
}
EOF
        echo "å·²åˆ›å»º: $build_file"
    fi
done
```

## ðŸ” é…ç½®éªŒè¯

### éªŒè¯å­æ¨¡å—é…ç½®
```bash
# æ£€æŸ¥æ‰€æœ‰å­æ¨¡å—build.gradle.ktsæ–‡ä»¶
find onevod/ -name "build.gradle.kts" -exec echo "æ£€æŸ¥: {}" \; -exec head -5 {} \;

# éªŒè¯ç¼–è¯‘
./gradlew :onevod:catvod:compileDebugJavaWithJavac
./gradlew :onevod:quickjs:compileDebugJavaWithJavac
```

### å¸¸è§é—®é¢˜è§£å†³

#### 1. åŒ…åå†²çª
```kotlin
// å¦‚æžœå‡ºçŽ°åŒ…åå†²çªï¼Œä¿®æ”¹namespace
android {
    namespace = "com.onetv.fongmi.catvod" // ä½¿ç”¨å”¯ä¸€åŒ…å
}
```

#### 2. ä¾èµ–å†²çª
```kotlin
// æŽ’é™¤å†²çªçš„ä¾èµ–
implementation("com.example:library:1.0") {
    exclude(group = "com.conflict", module = "conflict-module")
}
```

#### 3. åŽŸç”Ÿåº“é—®é¢˜
```kotlin
// ç¡®ä¿åŽŸç”Ÿåº“æ­£ç¡®æ‰“åŒ…
android {
    packagingOptions {
        jniLibs {
            useLegacyPackaging = true
        }
    }
}
```

## ðŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰å­æ¨¡å—ç›®å½•å·²åˆ›å»º
- [ ] æ¯ä¸ªå­æ¨¡å—éƒ½æœ‰build.gradle.ktsæ–‡ä»¶
- [ ] namespaceé…ç½®æ­£ç¡®
- [ ] ä¾èµ–å…³ç³»é…ç½®æ­£ç¡®
- [ ] åŽŸç”Ÿåº“æ–‡ä»¶å·²å¤åˆ¶
- [ ] Pythonè„šæœ¬æ–‡ä»¶å·²å¤åˆ¶
- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] æ¨¡å—é—´ä¾èµ–æ­£å¸¸

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å—é¡ºåº**ï¼šcatvodå¿…é¡»æœ€å…ˆç¼–è¯‘ï¼Œå…¶ä»–æ¨¡å—ä¾èµ–å®ƒ
2. **Pythonæ¨¡å—**ï¼šchaquoæ¨¡å—ç¼–è¯‘æ—¶é—´è¾ƒé•¿ï¼Œå¯è€ƒè™‘æŽ’é™¤
3. **åŽŸç”Ÿåº“**ï¼šç¡®ä¿.soæ–‡ä»¶åœ¨æ­£ç¡®çš„æž¶æž„ç›®å½•ä¸‹
4. **ç‰ˆæœ¬ç»Ÿä¸€**ï¼šæ‰€æœ‰å­æ¨¡å—ä½¿ç”¨ç›¸åŒçš„ç¼–è¯‘ç‰ˆæœ¬
5. **ä¾èµ–ç®¡ç†**ï¼šé¿å…é‡å¤ä¾èµ–å’Œç‰ˆæœ¬å†²çª

## ðŸš€ ä¼˜åŒ–å»ºè®®

1. **å…¨åŠŸèƒ½é›†æˆ**ï¼šåŒ…å«æ‰€æœ‰å­æ¨¡å—ç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§
2. **å…¨æ¨¡å—ä¿ç•™**ï¼šä¿ç•™æ‰€æœ‰è§£æžå™¨æ¨¡å—ï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘
3. **ä¾èµ–ä¼˜åŒ–**ï¼šä½¿ç”¨api/implementationåˆç†å£°æ˜Žä¾èµ–
4. **ç¼–è¯‘ä¼˜åŒ–**ï¼šå¯ç”¨å¹¶è¡Œç¼–è¯‘å’Œç¼“å­˜
5. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šç¡®ä¿FongMi_TVæ‰€æœ‰åŠŸèƒ½100%ä¿ç•™
